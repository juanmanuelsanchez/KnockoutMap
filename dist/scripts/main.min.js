/*! nbhMapKnockout - version 1.0.0 */
!function(){var a={currentCity:null,cities:["Bilbao"],foursquareData:[],filteredPlaces:[],filteredNames:[],pinPosterLocations:[],markers:[],infoWindows:[]},b={setFoursquareData:function(b){a.foursquareData=b},getFoursquareData:function(){return a.foursquareData},setFilteredPlaces:function(b){a.filteredPlaces=b},getFilteredPlaces:function(){return a.filteredPlaces},setFilteredNames:function(b){a.filteredNames=b},getFilteredNames:function(){return a.filteredNames},setMarkers:function(b){a.markers.push(b)},getMarkers:function(){return a.markers},setInfoWindows:function(b){a.infoWindows.push(b)},getInfoWindows:function(){return a.infoWindows},setPinPosterLocations:function(b){a.pinPosterLocations.push(b)},getPinPosterLocations:function(){return a.pinPosterLocations},clearMarkers:function(){a.markers=[]},clearInfoWindows:function(){a.infoWindows=[]}},c=function(a){var c=this;c.name=ko.observable(a.name),c.address=ko.observable(a.address),c.city=ko.observable(a.city),c.country=ko.observable(a.country),c.location=ko.observable(a.location),c.rating=ko.observable(a.rating),c.listView=ko.pureComputed(function(){return c.name()+"    "+c.rating()}),console.log(c.address()),b.setPinPosterLocations(c.location());var d=(b.getPinPosterLocations(),[]);d.push(c.location()),console.log(d);var e=document.getElementById("show");document.getElementById("hide"),document.getElementById("places-list"),document.getElementById("foursquare-header"),document.getElementById("autocomplete");e.style.display="none"},d={disableDefaultUI:!1};if("undefined"==typeof google)return $("#google-map-error-panel").html("<h2>Sorry, Google Maps could not be loaded</h2>"),void console.log("undefined!");var e=new google.maps.Map(document.getElementById("mapDiv"),d),f=function(){function d(a){return $.getJSON(j,function(b){var c=[];c=b.response.groups[0].items,a(c)}).error(function(a){g.html("<h2>Sorry, Foursquare articles could not be loaded</h2>")}),!1}var f=this;this.currentCity=ko.observableArray([]),this.currentCity=a.cities[0],console.log(f.currentCity);var g=($("#places-list"),$("#foursquare-error-panel"));$("#place");this.places=ko.observableArray([]),this.currentPlace=ko.observable(this.places()[0]);var h="WMGXUPU15HUVPMTMGK3WZPHVGBXKPXWMUQ5WW3DMRSOZUIH5",i="RFUOHDP441JSHFBS1AS0KLAGRVVRGNL2VACN0RHIJJNC5AT2",j="https://api.foursquare.com/v2/venues/explore?near="+f.currentCity+"&&client_id="+h+"&client_secret="+i+"&v=20130815&query=sushi";d(function(a){var d=a;console.log(d);var e=0,g=0,h=0,i=0,j=d.length,k=[],l=[];for(e;j>e;e++){var m=d[e],n=m.venue.name;"Miu Japonés"!=n&&"Miu"!=n&&"Shibui Bilbo"!=n&&"Wok Chitau Nauo"!=n&&"Restaurante Xikelai Wok"!=n&&"SUMO Ledesma"!=n&&"SUMO"!=n&&k.push(m)}for(g;g<k.length;g++){var o=k[g],p=o.venue.name,q=o.venue.location.address,r=o.venue.location.city,s=o.venue.location.country,t=o.venue.rating,u={name:p,address:q,city:r,country:s,location:p+", "+q+", "+r+", "+s,rating:t};l.push(u)}for(h;h<l.length;h++){var v,w=l[h],x=w.name;"Kuma"===x?(v=x.replace("Kuma","KUMA"),w.name=v):"Mao Restaurante"===x?(v=x.replace("Mao Restaurante","Mao"),w.name=v):"SUMO Poza"===x?(v=x.replace("SUMO Poza","SUMO Pozas"),w.name=v):"Sakura"===x?(v=x.replace("Sakura","Restaurante Sakura"),w.name=v):"Wasabi Bilbao Restaurante Japones"===x&&(v=x.replace("Wasabi Bilbao Restaurante Japones","Restaurante Wasabi Bilbao"),w.name=v)}for(i;i<l.length;i++){var y,w=l[i],z=w.address;"Lersundi Kalea, 3"===z?(console.log(" Wasabi Eureka!"),y=z.replace("Lersundi Kalea, 3","Lersundi Kalea, 3, 48009 Bilbao, Bizkaia, España"),w.address=y):"Arbolantxa 2"===z?(console.log(" Sakura Eureka!"),y=z.replace("Arbolantxa 2","Arbolantxa Kalea, 2, 48001 Bilbao, Bizkaia, España"),w.address=y):"Ercilla 8"===z?(console.log(" Kuma Eureka!"),y=z.replace("Ercilla 8","Ercilla Kalea, 8, 48009 Bilbao, Bizkaia, España"),w.address=y):"C/ Licenciado Poza, 39"===z?(console.log(" SUMO Pozas Eureka!"),y=z.replace("C/ Licenciado Poza, 39","Poza Lizentziatuaren Kalea, 39, 48011 Bilbao, Bizkaia, España"),w.address=y):"Ledesma, 30"===z?(console.log(" Asia Chic Eureka!"),y=z.replace("Ledesma, 30","Ledesma Musikariaren Kalea, 30, 48001 Bilbao, Bizkaia, España"),w.address=y):"Ibáñez de Bilbao, 11"===z?(console.log(" Mao Eureka!"),y=z.replace("Ibáñez de Bilbao, 11","Ibáñez de Bilbao Kalea, 11, 48009 Bilbao, Bizkaia, España"),w.address=y):"Licenciado Poza 48"===z&&(console.log(" Sushi Artist Eureka!"),y=z.replace("Licenciado Poza 48","Licenciado Poza 48, 48013 Bilbao, Biscay, España"),w.address=y)}l.forEach(function(a){f.places.push(new c(a))}),b.setFoursquareData(d),b.setFilteredPlaces(k),b.setFilteredNames(l),f.initializeMap()}),this.setCurrentPlace=function(a){f.currentPlace(a);var c=b.getMarkers();console.log(c);var d=b.getInfoWindows();$("#place");if(c.length<7){var g=0,h=0,i=0,j=0,k=(c.length,d.length);for(console.log(c),console.log(d),g;k>g;h++,g++){var l=c[g],m=d[h];if(a.address()==m.content&&a.address()===l.title)if(null!=l.getAnimation())for(j;k>j;i++,j++){var n=c[i],o=d[j];n.setAnimation(null),o.close(e,l)}else for(j;k>j;i++,j++){var p=c[i],q=d[j];p.setAnimation(null),q.close(e,l),l.setAnimation(google.maps.Animation.BOUNCE),m.open(e,l)}}}else{var g=0,h=0,i=0,j=0;c.splice(6),d.splice(6);var r=(c.length,d.length);for(g;r>g;h++,g++){var s=c[g],t=d[h];if(a.address()==t.content&&a.address()===s.title)if(null!=s.getAnimation())for(j;r>j;i++,j++){var u=c[i],v=d[j];u.setAnimation(null),v.close(e,s)}else for(j;r>j;i++,j++){var w=c[i],x=d[j];w.setAnimation(null),x.close(e,s),s.setAnimation(google.maps.Animation.BOUNCE),t.open(e,s)}}}},this.initializeMap=function(){function a(a){console.log(a);var c=a.geometry.location.lat(),d=a.geometry.location.lng(),f=(a.name,a.formatted_address),g=window.mapBounds,h=new google.maps.Marker({map:e,position:a.geometry.location,title:f});b.setMarkers(h);var i=new google.maps.InfoWindow({content:f});b.setInfoWindows(i),google.maps.event.addListener(h,"click",function(){i.open(e,h)}),g.extend(new google.maps.LatLng(c,d)),e.fitBounds(g),e.setCenter(g.getCenter())}function c(b,c){var d=$("#google-map-error-panel");return c!=google.maps.places.PlacesServiceStatus.OK?void d.html("<h2>Sorry, Google Maps could not be loaded</h2>"):void(c==google.maps.places.PlacesServiceStatus.OK&&a(b[0]))}function d(a){if("undefined"==typeof google.maps.places)return $("#google-map-error-panel").html("<h2>Sorry, Google Maps could not be loaded</h2>"),void console.log("undefined!");var b=new google.maps.places.PlacesService(e);for(place in a){var d={query:a[place]};b.textSearch(d,c)}}function f(a){var b=0,c=j.length;for(console.log(c),b;c>b;b++)j[b].setMap(a)}function g(){n.style.display="block",n.style.webkitAnimationName="fadeIn",n.style.webkitAnimationDuration="1s",o.value=" ",j.splice(6),k.splice(6),f(e)}function h(){f(null)}var i=b.getPinPosterLocations();console.log("Recogida de datos en PacesViewModel:"+i);var j=b.getMarkers();console.log(j);var k=b.getInfoWindows();console.log(k);var l=document.getElementById("show"),m=document.getElementById("hide"),n=document.getElementById("places-list"),o=(document.getElementById("foursquare-header"),document.getElementById("autocomplete")),p=document.getElementById("place");l.style.display="none",$(o).devbridgeAutocomplete({lookup:i,minChars:1,onSearchComplete:function(a,b){n.style.display="none",n.style.webkitAnimationName="fadeOut",n.style.webkitAnimationDuration="1s",l.style.display="none",l.style.webkitAnimationName="fadeOut",l.style.webkitAnimationDuration="1s",p.style.display="none",p.style.webkitAnimationName="fadeOut",p.style.webkitAnimationDuration="1s";var c=[];for(suggestion in b){var e=b[suggestion].value;c.push(e)}h(),d(c)},onSelect:function(a){var b=[],c=a.value;b.push(c),console.log(b),h(),d(b),"none"==m.style.display&&"none"==l.style.display&&(m.style.display="inline",m.style.webkitAnimationName="fadeIn",m.style.webkitAnimationDuration="0.8s")},showNoSuggestionNotice:!0,noSuggestionNotice:"Sorry, no matching results"}),l.addEventListener("click",function(){g(),l.style.display="none",l.style.webkitAnimationName="fadeOut",l.style.webkitAnimationDuration="1s",m.style.display="inline",m.style.webkitAnimationName="fadeIn",m.style.webkitAnimationDuration="0.8s","none"==p.style.display&&(p.style.display="block",p.style.webkitAnimationName="fadeIn",p.style.webkitAnimationDuration="1s")},!1),m.addEventListener("click",function(){h(),l.style.display="inline",l.style.webkitAnimationName="fadeIn",l.style.webkitAnimationDuration="0.8s",m.style.display="none",m.style.webkitAnimationName="fadeOut",m.style.webkitAnimationDuration="1s"},!1),window.mapBounds=new google.maps.LatLngBounds,d(i),window.addEventListener("resize",function(a){e.fitBounds(mapBounds)})}};ko.applyBindings(new f)}();